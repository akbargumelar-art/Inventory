// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id           String        @id @default(cuid())
  name         String
  username     String        @unique
  email        String        @unique
  password     String
  role         UserRole      @default(Viewer)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  stockHistory StockHistory[]
  borrowings   Borrowing[]
}

model Location {
  id          String @id @default(cuid())
  code        String @unique
  name        String
  address     String?
  description String?
  items       Item[]
}

model Category {
  id        String     @id @default(cuid())
  name      String
  parentId  String?
  parent    Category?  @relation("ParentChild", fields: [parentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  children  Category[] @relation("ParentChild")
  items     Item[]
}

model Item {
  id                String        @id @default(cuid())
  sku               String        @unique
  barcode           String        @unique
  name              String
  description       String?
  categoryId        String
  category          Category      @relation(fields: [categoryId], references: [id])
  defaultLocationId String
  location          Location      @relation(fields: [defaultLocationId], references: [id])
  unit              ItemUnit      @default(pcs)
  stock             Int           @default(0)
  minStock          Int           @default(0)
  price             Float         @default(0)
  currency          String        @default("IDR")
  status            ItemStatus    @default(Aktif)
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  stockHistory      StockHistory[]
  borrowings        Borrowing[]
}

model StockHistory {
  id             String           @id @default(cuid())
  timestamp      DateTime         @default(now())
  userId         String
  user           User             @relation(fields: [userId], references: [id])
  itemId         String
  item           Item             @relation(fields: [itemId], references: [id])
  type           StockHistoryType
  quantityChange Int
  reason         String?
}

model Borrowing {
  id                 String          @id @default(cuid())
  itemId             String
  item               Item            @relation(fields: [itemId], references: [id])
  userId             String
  user               User            @relation(fields: [userId], references: [id])
  borrowerName       String
  borrowDate         DateTime        @default(now())
  expectedReturnDate DateTime
  actualReturnDate   DateTime?
  status             BorrowingStatus @default(Dipinjam)
  notes              String?
  createdAt          DateTime        @default(now())
  updatedAt          DateTime        @updatedAt
}

enum UserRole {
  Administrator
  InputData
  Viewer
}

enum ItemUnit {
  pcs
  kg
  liter
  meter
}

enum ItemStatus {
  Aktif
  NonAktif
  Baik
  Rusak
}

enum StockHistoryType {
  Penerimaan
  Penjualan
  Transfer
  Koreksi
  Retur
  Dipinjamkan
  Dikembalikan
  Dijual
  Hilang
  Diberikan
}

enum BorrowingStatus {
  Dipinjam
  Kembali
}